{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags %}

{% block body_class %}template-homepage{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/global_peptide_groups.css' %}">
{% endblock %}

{% block content %}
<div class="container py-4">

    <div class="row mb-4">
        <div class="col-12">
            <div class="bg-light rounded p-5 text-center" style="min-height: 200px;">
            </div>
        </div>
    </div>

    <hr class="blue">

    <div class="row mb-4">
        <div class="col-12">
            <h1 class="page-top-header">Recent Peptide Publications</h1>
        </div>
    </div>

    <!-- Research Cards - Flexbox Grid -->
    <div class="research-grid mb-4">
        {% for item in research_items %}
        <a href="{% url 'research_item_detail' slug=item.slug %}" class="research-card-link">
            <div class="card research-card">
                {% if item.main_image %}
                {% image item.main_image fill-400x275 as card_img %}
                <img src="{{ card_img.url }}" class="card-img-top" alt="{{ item.short_title }}">
                {% else %}
                <div class="bg-secondary card-img-placeholder"></div>
                {% endif %}
                <div class="card-body p-2">
                    <h3 class="card-title small mb-1">{{ item.short_title }}</h3>
                    <p class="card-text small text-muted mb-0">{{ item.lab_name }}</p>
                    <p class="card-text small text-muted mb-0">{{ item.publish_date|date:"M j, Y" }}</p>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>

    <hr class="blue">

    <div class="row">

        <!-- Feature Blocks Column -->
        <div class="col-md-8">

            <div class="mb-4">
                <h2 class="page-top-header">Global Peptide Groups</h2>
                <p class="small" style="margin-top:-10px; margin-bottom:20px; font-style:italic;">
                    Featuring Internationally Notable Peptide Science Research Groups.
                </p>
                {% if current_gpg %}
                <div class="row align-items-stretch">
                    <div class="col-md-5 mb-3 mb-md-0">
                        <div class="gpg-homepage-blurb h-100">
                            <h3 class="h5 mb-2">
                                <a href="{% pageurl current_gpg %}" class="text-decoration-none">{{ current_gpg.lab_name }}</a>
                            </h3>
                            {% if current_gpg.pi_name or current_gpg.institution %}
                            <p class="small text-muted mb-2">
                                {% if current_gpg.pi_name %}{{ current_gpg.pi_name }}{% endif %}
                                {% if current_gpg.institution %} Â· {{ current_gpg.institution }}{% endif %}
                            </p>
                            {% endif %}
                            <p class="mb-2">{{ current_gpg.blurb|truncatewords:50 }}</p>
                            <a href="{% pageurl current_gpg %}" class="btn btn-sm btn-outline-primary">Read More</a>
                        </div>
                    </div>
                    <div class="col-md-7">
                        {% if current_gpg.featured_image %}
                        <a href="{% pageurl current_gpg %}">
                            {% image current_gpg.featured_image width-600 as gpg_img %}
                            <img src="{{ gpg_img.url }}" class="img-fluid rounded gpg-homepage-img{% if current_gpg.slug == 'the-sun-group' %} gpg-img-bottom{% endif %}" alt="{{ current_gpg.lab_name }}">
                        </a>
                        {% else %}
                        <div class="bg-secondary rounded h-100" style="min-height: 180px;"></div>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="row">
                    <div class="col-12">
                        <div class="bg-light rounded p-4 text-center">
                            <p class="text-muted mb-0">No featured group selected.</p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <hr class="blue">

            <div class="mb-4">
                <h2 class="page-top-header">Student Spotlight</h2>
                <p class="small" style="margin-top:-10px; margin-bottom:20px; font-style:italic;">
                    Highlighting outstanding graduate students shaping the future of peptide science.
                </p>
                <div class="row">
                    <div class="col-md-5">
                        <div class="bg-light rounded p-4" style="min-height: 180px;">
                        </div>
                    </div>
                    <div class="col-md-7">
                        <div class="bg-secondary rounded" style="height: 180px;"></div>
                    </div>
                </div>
            </div>

            <hr class="blue">

            <div class="mb-4">
                <h2 class="page-top-header">Peptide Postdocs</h2>
                <p class="small" style="margin-top:-10px; margin-bottom:20px; font-style:italic;">
                    Recognizing postdoctoral researchers advancing peptide science.
                </p>
                {% if featured_postdoc %}
                <div class="row align-items-stretch">
                    <div class="col-md-5 mb-3 mb-md-0">
                        <div class="postdoc-homepage-blurb h-100">
                            <h3 class="h5 mb-2">
                                <a href="{% url 'postdoc_detail' slug=featured_postdoc.slug %}" class="text-decoration-none">{{ featured_postdoc.full_name }}</a>
                            </h3>
                            <p class="small text-muted mb-2">
                                {{ featured_postdoc.position_title }}<br>
                                {{ featured_postdoc.lab_name }}, {{ featured_postdoc.institution }}
                            </p>
                            <p class="mb-2">{{ featured_postdoc.homepage_blurb|truncatewords:50 }}</p>
                            <a href="{% url 'postdoc_detail' slug=featured_postdoc.slug %}" class="btn btn-sm btn-outline-primary">Read More</a>
                        </div>
                    </div>
                    <div class="col-md-7">
                        {% if featured_postdoc.headshot %}
                        <a href="{% url 'postdoc_detail' slug=featured_postdoc.slug %}">
                            {% image featured_postdoc.headshot fill-600x400 as postdoc_img %}
                            <img src="{{ postdoc_img.url }}" class="img-fluid rounded" alt="{{ featured_postdoc.full_name }}">
                        </a>
                        {% else %}
                        <div class="bg-secondary rounded h-100" style="min-height: 180px;"></div>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="row">
                    <div class="col-12">
                        <div class="bg-light rounded p-4 text-center">
                            <p class="text-muted mb-0">No featured postdoc selected.</p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <hr class="blue">

            <div class="mb-4">
                <h2 class="page-top-header">Featured</h2>
                <p class="small" style="margin-top:-10px; margin-bottom:20px; font-style:italic;">
                    Special announcements and highlighted content.
                </p>
                <div class="row">
                    <div class="col-md-5">
                        <div class="bg-light rounded p-4" style="min-height: 180px;">
                        </div>
                    </div>
                    <div class="col-md-7">
                        <div class="bg-secondary rounded" style="height: 180px;"></div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Sidebar Column - News Section -->
        <div class="col-md-4">

            {% for news in news_items %}
            <div class="news-item mb-4">
                <h3 style="font-weight: 600; font-size: 1.3em; padding-left: 8px; border-left: 4px solid var(--aps-green); margin-bottom: 12px;">{{ news.title }}</h3>
                {% if news.image %}
                {% image news.image original as news_img %}
                <img src="{{ news_img.url }}" class="news-item-image" alt="{{ news.title }}">
                {% endif %}
                {% if news.body %}
                <div class="news-item-body">{{ news.body|safe }}</div>
                {% endif %}
                <p class="small text-muted mb-2">{{ news.publish_date|date:"M j, Y" }}</p>
                {% if news.link_url and news.link_url != '#' %}
                <a href="{{ news.link_url }}" class="btn btn-sm btn-outline-primary"{% if news.is_external %} target="_blank" rel="noopener"{% endif %}>
                    {{ news.link_text }}{% if news.is_external %} <i class="bi bi-box-arrow-up-right"></i>{% endif %}
                </a>
                {% endif %}
            </div>
            {% if not forloop.last %}
            <hr class="blue">
            {% endif %}
            {% empty %}
            <div class="bg-light rounded p-3 text-center">
                <p class="text-muted mb-0 small">No news items yet.</p>
            </div>
            {% endfor %}

        </div>

    </div>

</div>
{% endblock content %}
